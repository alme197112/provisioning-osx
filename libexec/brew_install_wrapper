#!/bin/sh -e

## Copyright (C) 2015 Luca Favatella <slackydeb@gmail.com>

brew_cleanup() {
    local C; C=$(brew cleanup -s 2>&1) || { echo "'brew cleanup -s' failed. Exiting. Info: $C" >&2; exit 1; }
    local CC; CC=$(brew cask cleanup 2>&1) || { echo "'brew cask cleanup' failed. Exiting. Info: $CC" >&2; exit 1; }
}

brew_doctor() {
    local D; D=$(brew doctor 2>&1) || { echo "'brew doctor' detected potential problems. Continuing. Info: $D" >&2; }
    local CD; CD=$(brew cask doctor 2>&1) || { echo "'brew cask doctor' detected potential problems. Exiting. Info: $CD" >&2; exit 1; }
}

BREW_INSTALL1="${1:?}" ## Mandatory.
BREW_INSTALL2="${2:?}" ## Mandatory.

brew update ## Synonym of `brew cask update`. Ref https://github.com/caskroom/homebrew-cask/blob/v0.56.0/doc/src/brew-cask.1.md#commands
brew upgrade

brew install caskroom/cask/brew-cask

sh -c "$BREW_INSTALL1"
sh -c "$BREW_INSTALL2"

brew_cleanup
brew_doctor
